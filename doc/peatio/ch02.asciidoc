:toc:

== peatio 설치


=== peatio clone

```
git clone https://github.com/muhammednagy/peatio.git
```

=== setup-local-ubuntu.md 문서 읽기
 - build from source code and run


=== 설치 확인

mysql - RubyMine Database Plugin

redis - RubyMine Redis Servers Plugin

rabbitMQ - http://localhost:15672, guest /guest

bitcoin-qt - gui

peatio daemons & rails
- ps -ef | grep -v grep | grep "\(\.rb$\|peatio\|rbenv\)" | sort -k 8

=== docker로 설치

consider docker-image

```
sudo usermod -a -G docker $USER
id

# logout and login
id
```

https://help.ubuntu.com/lts/serverguide/certificates-and-security.html
https://askubuntu.com/questions/49196/how-do-i-create-a-self-signed-ssl-certificate

https://www.digitalocean.com/community/tutorials/how-to-create-an-ssl-certificate-on-nginx-for-ubuntu-14-04

```
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
```

```
tar czvf /tmp/a.tgz peatio
cd peatio/doc/docker
tar xzvf /tmp/a.tgz
find peatio -type f -exec dos2unix {} \; -print
```


==== README.md
```
cd peatio/doc/docker
docker build -t peatio:base .
./bin/base.sh
./bin/webapp.sh
```

==== ./bin/base.sh
```
docker run -d --name redis redis
docker run -d --name dbmaster -v /dbdata:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=ROOT_PASSWORD -e MYSQL_USER=DATABASE_USER -e MYSQL_PASSWORD=PASSWORD -e MYSQL_DATABASE=DATABSE_NAME mysql
docker run -d --name rabbitmq rabbitmq

```

==== ./bin/webapp.sh
```
# build Dockerfile to image peatio:base first !!!
docker run -d --name webapp \
  -p 80:80 -p 18080:18080 -p 443:443 \
  --link rabbitmq:rabbitmq \
  --link dbmaster:dbmaster \
  --link redis:redis \
  peatio:base /sbin/my_init --enable-insecure-key

docker exec -it webapp bash -lc 'cd /home/app/peatio/; git pull;'
docker exec -it webapp bash -lc 'cd /home/app/peatio/; RAILS_ENV=production ./bin/rake db:migrate;'
docker exec -it webapp bash -lc 'cd /home/app/peatio/; RAILS_ENV=production ./bin/rake assets:precompile;'
```